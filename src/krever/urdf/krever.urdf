<?xml version="1.0"?>
<robot name="krever">
   
<!--colors-->
    <material name="green">
        <color rgba="0 1 0 1"/>
    </material>

    <material name="blue">
        <color rgba="0 0 0.7 1"/>
    </material>

    <material name="red">
        <color rgba="0.7 0 0 1"/>
    </material>
     
    
    <link name="base_footprint"/>
    


<!--base chassis-->
    <link name="base_link">
        <visual>
            <geometry>
                <box size="0.6 0.6 0.2"/>
            </geometry>
            <origin xyz="0 0 0.125" rpy="0 0 0"/>
            <material name="red"/>
        </visual>

        <collision>
            <geometry>
                <box size="0.6 0.6 0.2"/>
            </geometry>
            <origin xyz="0 0 0.125" rpy="0 0 0"/>
            <material name="red"/>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.125" rpy="0.0 0.0 0.0"/>
            <mass value="15.0"/>
            <inertia ixx="0.5" ixy="0.0" ixz="0.0" iyy="0.5" iyz="0.0" izz="0.9"/>
        </inertial>
        

    </link>

    <joint name="base_joint" type="fixed">
        <parent link="base_footprint"/>
        <child link="base_link"/>
        <origin xyz="0 0 0.0" rpy="0 0 0"/>
    </joint>



<!--lidar-->
    <link name="lidar">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="blue"/>
        </visual>
        <collision>
            <geometry>
                <cylinder radius="0.1" length="0.05"/>
            </geometry>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <material name="blue"/>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="0.4"/>
            <inertia ixx="0.0026" ixy="0.0" ixz="0.0" iyy="0.0026" iyz="0.0" izz="0.0003"/>
        </inertial>
        

    </link>

    <joint name="base_lidar_joint" type="fixed">
        <parent link="base_link"/>
        <child link="lidar"/>
        <origin xyz="0 0 0.25" rpy="0 0 0"/>
    </joint>

    <!-- Add the Gazebo plugin for the LiDAR sensor -->
    <gazebo>
        <plugin name="gazebo_ros_laser" filename="libgazebo_ros_ray_sensor.so">
            <robotNamespace>/</robotNamespace>
            <bodyName>lidar_link</bodyName>
            <topicName>/lidar</topicName>
            <frameName>lidar_link</frameName>
            <updateRate>20</updateRate>
            <ray>
                <scan>
                    <horizontal>
                        <samples>360</samples>
                        <resolution>1</resolution>
                        <min_angle>-1.5708</min_angle>
                        <max_angle>1.5708</max_angle>
                    </horizontal>
                </scan>
                <range>
                    <min>0.1</min>
                    <max>10.0</max>
                    <resolution>0.01</resolution>
                </range>
                <noise>
                    <type>gaussian</type>
                    <mean>0.0</mean>
                    <stddev>0.01</stddev>
                </noise>
            </ray>
        </plugin>
    </gazebo>


<!-- left wheel-->
    <link name="left_wheel">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.03"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
            <material name="green"/>
        </visual>
        <collision>
            <geometry>
                <cylinder radius="0.1" length="0.03"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
            <material name="green"/>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="0.8"/>
            <inertia ixx="0.004" ixy="0.0" ixz="0.0" iyy="0.004" iyz="0.0" izz="0.0006"/>
        </inertial>
        
    </link>

    <joint name="left_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="left_wheel"/>
        <origin xyz="0 0.315 0.05" rpy="0 0 0"/>
        <axis xyz="0 1 0"/>
        <limit effort="10.0" velocity="5.0"/>

        <ros2_control>
            <hardware>
                <plugin>ign_ros2_control/GazeboSystem</plugin>
            </hardware>
            <command_interface name="velocity"/>
            <state_interface name="velocity"/>
        </ros2_control>
    </joint>

    <transmission name="left_wheel_transmission">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="left_wheel_joint">
            <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
        </joint>
        <actuator name="left_wheel_motor">
            <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
        </actuator>
    </transmission>


<!--right wheel-->
    <link name="right_wheel">
        <visual>
            <geometry>
                <cylinder radius="0.1" length="0.03"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
            <material name="green"/>
        </visual>
        <collision>
            <geometry>
                <cylinder radius="0.1" length="0.03"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
            <material name="green"/>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="0.8"/>
            <inertia ixx="0.004" ixy="0.0" ixz="0.0" iyy="0.004" iyz="0.0" izz="0.0006"/>
        </inertial>
    </link>

    <joint name="right_wheel_joint" type="continuous">
        <parent link="base_link"/>
        <child link="right_wheel"/>
        <origin xyz="-0 -0.315 0.05" rpy="0 0 0"/>
        <axis xyz="0 1 0"/>
        <limit effort="10.0" velocity="5.0"/>

        <ros2_control>
            <hardware>
                <plugin>ign_ros2_control/GazeboSystem</plugin>
            </hardware>
            <command_interface name="velocity"/>
            <state_interface name="velocity"/>
        </ros2_control>

    </joint>

    <transmission name="right_wheel_transmission">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="right_wheel_joint">
            <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
        </joint>
        <actuator name="right_wheel_motor">
            <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
        </actuator>
    </transmission>



<!-- caster wheel1 -->
    <link name="caster_wheel1">
        <visual>
            <geometry>
                <sphere radius="0.045"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
            <material name="blue"/>
        </visual>
        <collision>
            <geometry>
                <sphere radius="0.045"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
            <material name="blue"/>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="0.1"/>
            <inertia ixx="0.000025" ixy="0.0" ixz="0.0" iyy="0.000025" iyz="0.0" izz="0.000025"/>
        </inertial>
        
    
    </link>
    
    <joint name="body_caster_wheel_joint1" type="fixed">
        <parent link="base_link"/>
        <child link="caster_wheel1"/>
        <origin xyz="0.25 0 0.0" rpy="0 0 0"/>
        <gazebo>
            <joint>
                <surface>
                    <friction>
                        <ode>
                            <mu>0.001</mu>            <!-- Coefficient of friction -->
                            <mu2>0.001</mu2>          <!-- Coefficient of friction in the perpendicular direction -->
                        </ode>
                    </friction>
                </surface>
            </joint>
        </gazebo>
    </joint>

<!-- caster wheel2 -->
    <link name="caster_wheel2">
        <visual>
            <geometry>
                <sphere radius="0.045"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
            <material name="blue"/>
        </visual>
        <collision>
            <geometry>
                <sphere radius="0.045"/>
            </geometry>
            <origin xyz="0 0 0" rpy="1.57 0 0"/>
            <material name="blue"/>
        </collision>

        
        
    </link>
    
    <joint name="body_caster_wheel_joint2" type="fixed">
        <parent link="base_link"/>
        <child link="caster_wheel2"/>
        <origin xyz="-0.25 0 0.0" rpy="0 0 0"/>
        <gazebo>
            <joint>
                <surface>
                    <friction>
                        <ode>
                            <mu>0.001</mu>            <!-- Coefficient of friction -->
                            <mu2>0.001</mu2>          <!-- Coefficient of friction in the perpendicular direction -->
                        </ode>
                    </friction>
                </surface>
            </joint>
        </gazebo>

    </joint>



<!--supporint rod-->
    <link name="support_rod">
        <visual>
            <geometry>
                <box size="0.06 0.1 1.0" />
            </geometry>
            <material name="LightGrey">
                <color rgba="0.7 0.7 0.7 1.0"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <box size="0.06 0.1 1.0" />
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="7"/>
            <inertia ixx="1.2625" ixy="0.0" ixz="0.0" iyy="1.2545" iyz="0.0" izz="0.017"/>
        </inertial>
        

        
    </link>

    <joint name="base_suppot_joint" type="fixed">
        <origin xyz="-0.255 0. 0.725" rpy="0.0 0.0 0.0"/>
        <parent link="base_link"/>
        <child link="support_rod"/>
        <limit lower="0.0" upper="0.0" effort="0.0" velocity="0.0"/>
    </joint>


<!--u1-->
    <link name="center_rod">
        <visual>
            <geometry>
                <box size="0.4 0.1 0.04" />
            </geometry>
            <material name="black">
                <color rgba="0 0 0 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <box size="0.4 0.1 0.04" />
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="2"/>
            <inertia ixx="0.002" ixy="0.0" ixz="0.0" iyy="0.027" iyz="0.0" izz="0.028"/>
        </inertial>
        

    </link>

    <joint name="center_rod_joint" type="fixed">
        <origin xyz="0 0 0.52" rpy="0.0 0.0 1.57"/>
        <parent link="support_rod"/>
        <child link="center_rod"/>
        <limit lower="0.0" upper="0.0" effort="0.0" velocity="0.0"/>
    </joint>

<!--u2-->
    
    <link name="left_rod">
        <visual>
            <geometry>
                <box size="0.6 0.1 0.04" />
            </geometry>
            <material name="black">
                <color rgba="0 0 0 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <box size="0.6 0.1 0.04" />
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="2"/>
            <inertia ixx="0.002" ixy="0.0" ixz="0.0" iyy="0.06" iyz="0.0" izz="0.061"/>
        </inertial>
        

    </link>

    <joint name="left_rod_joint" type="fixed">
        <origin xyz="0.25 0.25 0.52" rpy="0.0 0.0 0"/>
        <parent link="support_rod"/>
        <child link="left_rod"/>
        <limit lower="0.0" upper="0.0" effort="0.0" velocity="0.0"/>
    </joint>    


<!--u3-->
    
    <link name="right_rod">
        <visual>
            <geometry>
                <box size="0.6 0.1 0.04" />
            </geometry>
            <material name="black">
                <color rgba="0 0 0 1"/>
            </material>
        </visual>
        <collision>
            <geometry>
                <box size="0.6 0.1 0.04" />
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="2"/>
            <inertia ixx="0.002" ixy="0.0" ixz="0.0" iyy="0.06" iyz="0.0" izz="0.061"/>
        </inertial>
    </link>

    <joint name="right_rod_joint" type="fixed">
        <origin xyz="0.25 -0.25 0.52" rpy="0.0 0.0 0"/>
        <parent link="support_rod"/>
        <child link="right_rod"/>
        <limit lower="0.0" upper="0.0" effort="0.0" velocity="0.0"/>
    </joint>

<!--tray-->
    <link name="tray">
        <visual>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <geometry>
                <box size="0.6 0.6 0.01"/>
            </geometry>
            <material name="white">
                <color rgba="1.0 1.0 1.0 1.0"/>
            </material>
        </visual>
        <collision>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <geometry>
                <box size="0.6 0.6 0.01"/>
            </geometry>
        </collision>

        <inertial>
            <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
            <mass value="5"/>
            <inertia ixx="0.154" ixy="0.0" ixz="0.0" iyy="0.154" iyz="0.0" izz="0.3"/>
        </inertial>
        
    </link>

    <joint name="tray_joint" type="fixed">
        <origin xyz="0.27 0.0 -0.43" rpy="0.0 0.0 0.0"/>
        <parent link="support_rod"/>
        <child link="tray"/>
        <limit lower="0.0" upper="0.0" effort="0.0" velocity="0.0"/>
    </joint>

    <ros2_control>
        <controller>
            <name>diff_drive_controller</name>
            <type>diff_drive_controller/DiffDriveController</type>
            <parameters>
                <left_wheel>left_wheel_joint</left_wheel>
                <right_wheel>right_wheel_joint</right_wheel>
                <wheel_separation>0.63</wheel_separation>
                <wheel_radius>0.1</wheel_radius>
                <publish_rate>50</publish_rate>
                <velocity_rolling_window_size>10</velocity_rolling_window_size>
                <cmd_vel_timeout>0.5</cmd_vel_timeout>
                <use_stamped_vel>false</use_stamped_vel>
                <open_loop>false</open_loop>
            </parameters>
        </controller>
    </ros2_control>
</robot>